---
title: "Mulitiplicative_SBF"
output: html_document
date: "2025-12-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# R_code_description

This file should produce the same plots as the paper

## Load packages

```{r}
graphics.off()
library(parallel) 
library("MASS") 
```

## Parameters set

This set of parameters corresponds to the most challenging simulation setup in Section 5 of the paper: Model 2, sample size 200, highly correlated covariates(0.8), and the differences in numerical stability and ISE between smooth backfitting and the Lin–He–Huang (2016) method are compared through 200 Monte Carlo repetitions.

```{r}
d_par <- c(3)       # the dimension of data, including time (time + z1 + z2)
rho_par <- c(0.8)   # the correlation between Z tilde
n_par <- c(200)     # the number of observations of data
model_par <- c(2)   # model2
n_sim_par <- c(200) # number of simulation
n_cores <- c(7)
r <- 1:n_sim_par    # list for index

```


## Seeds set

```{r}
set.seed(123)
jobs <- expand.grid(d_par, rho_par, model_par, n_par, n_sim_par, n_cores, r) ## dataframe for running
jobs <- lapply(1:nrow(jobs), function(x){list(jobs=jobs[x,],seeds=round(runif(n_sim_par,0,999999999)))}) ## assign different seeds
```


## Main function

### smooth.alpha funcion

Because we need 


```{r}

myparallelfunction <- function(x){
<<<<<<< HEAD
  smooth.alpha <- function(a, K_x_b, k_x_b, k_x, k_b ){
=======
  
  smooth.alpha <- function(alpha, K_X_b,k_X_b, K_b,k_b, b, n_grid, d,n,nb, get_baseline ){
    alpha_smooth_i <- array(dim = c(d,n))
    alpha_smooth_i_0 <- array(dim = c(n,n_grid[1]))
    for ( k in 1:d ) {
      if (k==1){
        for (i in 1:n) {
          alpha_smooth_i[k,i] <- 1
          alpha_smooth_i_0[i,] <- (K_b/k_b)%*%alpha[[k]]}}  # no weight dx because they are the same and constant, can be cancelled (TODO)
    }else for (i in 1:n) {
      alpha_smooth_i[k,i] <- (K_X_b[[k]][i,]/k_X_b[[k]][i])%*%alpha[[k]] 
    }
>>>>>>> 2a47fd64c9c427e7993f0583956af1fd1dc7d9d7
    
    if (get_baseline==FALSE) return(alpha_smooth_i) else return(list(alpha_smooth_i = alpha_smooth_i, alpha_smooth_i_0 = alpha_smooth_i_0))
  }
  
  get.denominator <- function(){}
  
  
  
}
```




